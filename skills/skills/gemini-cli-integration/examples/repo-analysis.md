# 代码仓库分析示例

使用Gemini CLI的100万token上下文分析整个代码仓库。

---

## 核心优势

```
Gemini CLI + --all-files = 仓库级理解

传统方式:
├─► 手动选文件
├─► 分批分析
├─► 人工整合
└─► 可能遗漏关联

Gemini方式:
└─► 一次性扫描全部文件
    - 自动理解文件关系
    - 发现跨文件问题
    - 给出全局视角
```

---

## 场景1: 新项目接手

### 触发语

```
用Gemini帮我了解这个项目的整体架构 /path/to/new-project
```

### 执行命令

```bash
cd /path/to/new-project && gemini --all-files -p "我刚接手这个项目，请帮我快速了解：

## 需要了解的内容
1. **项目概述**: 这是什么项目？解决什么问题？
2. **技术栈**: 使用了哪些技术、框架、库？
3. **目录结构**: 主要目录的作用是什么？
4. **核心模块**: 最重要的几个模块和它们的职责
5. **数据流**: 数据是怎么流转的？
6. **入口点**: 从哪里开始看代码？

## 输出格式

### 项目概述
...

### 技术栈
| 类型 | 技术 | 版本 |
|------|------|------|

### 目录结构
\`\`\`
project/
├── src/        # 说明
├── ...
\`\`\`

### 核心模块
1. **模块名** - 职责描述

### 数据流
用户请求 → ... → 响应

### 入门建议
1. 先看 xxx
2. 然后 xxx" --yolo
```

### 预期输出

```markdown
### 项目概述
这是一个电商后台管理系统，用于管理商品、订单、用户。
前后端分离架构，后端提供RESTful API。

### 技术栈
| 类型 | 技术 | 版本 |
|------|------|------|
| 后端框架 | Express | 4.18 |
| 数据库 | MongoDB | 6.0 |
| ORM | Mongoose | 7.0 |
| 认证 | JWT | - |
| 前端 | React | 18.2 |
| 状态管理 | Redux Toolkit | 1.9 |

### 目录结构
```
ecommerce-admin/
├── server/
│   ├── controllers/   # 请求处理
│   ├── models/        # 数据模型
│   ├── routes/        # 路由定义
│   ├── middleware/    # 中间件
│   └── utils/         # 工具函数
├── client/
│   ├── src/
│   │   ├── components/ # UI组件
│   │   ├── pages/      # 页面
│   │   ├── store/      # Redux
│   │   └── api/        # API调用
└── shared/            # 前后端共享
```

### 核心模块
1. **ProductController** - 商品CRUD，库存管理
2. **OrderService** - 订单状态机，支付集成
3. **AuthMiddleware** - JWT验证，权限控制
4. **Dashboard** - 数据统计，图表展示

### 数据流
用户请求 → AuthMiddleware验证 → Router分发 → Controller处理 → Service业务逻辑 → Model数据操作 → 响应

### 入门建议
1. 先看 `server/routes/index.js` 了解API全貌
2. 然后 `server/models/` 理解数据结构
3. 接着 `client/src/pages/` 对应功能页面
```

---

## 场景2: 代码质量审查

### 触发语

```
让Gemini扫描项目，找出潜在问题
```

### 执行命令

```bash
cd /path/to/project && gemini --all-files -p "请对这个项目进行代码质量审查：

## 审查维度
1. **安全问题**: SQL注入、XSS、敏感信息泄露等
2. **性能问题**: N+1查询、内存泄漏风险、无缓存等
3. **代码规范**: 命名不一致、重复代码、过长函数等
4. **架构问题**: 循环依赖、职责不清、耦合过高等
5. **错误处理**: 未捕获异常、错误信息不友好等

## 输出格式

### 🔴 高危问题 (必须修复)
| 文件 | 行号 | 问题 | 风险 | 修复建议 |

### 🟡 中危问题 (建议修复)
| 文件 | 行号 | 问题 | 影响 | 修复建议 |

### 🟢 低危问题 (可以优化)
| 文件 | 问题 | 建议 |

### 📊 统计
- 高危: X个
- 中危: X个
- 低危: X个

### 🎯 修复优先级
1. 最先处理: xxx
2. 其次: xxx" --yolo
```

---

## 场景3: 依赖分析

### 触发语

```
用Gemini分析项目的依赖关系
```

### 执行命令

```bash
cd /path/to/project && gemini --all-files -p "请分析这个项目的模块依赖关系：

## 分析内容
1. **外部依赖**: 使用了哪些第三方库？各自作用？
2. **内部依赖**: 模块之间的调用关系
3. **依赖健康度**: 是否有过时/废弃的依赖？
4. **循环依赖**: 是否存在循环引用？
5. **优化建议**: 可以移除或替换的依赖

## 输出格式

### 外部依赖清单
| 依赖 | 版本 | 用途 | 是否必要 |

### 模块依赖图
\`\`\`
ModuleA
├─► ModuleB
├─► ModuleC
│   └─► ModuleD
\`\`\`

### 问题发现
- 循环依赖: ...
- 过时依赖: ...
- 冗余依赖: ...

### 优化建议
1. ..." --yolo
```

---

## 场景4: API文档生成

### 触发语

```
让Gemini根据代码生成API文档
```

### 执行命令

```bash
cd /path/to/project && gemini --all-files -p "请根据代码生成API文档：

## 要求
1. 找出所有API端点
2. 提取请求/响应格式
3. 整理成标准API文档格式

## 输出格式

# API 文档

## 认证
说明认证方式...

## 端点列表

### 用户模块

#### POST /api/users/login
**描述**: 用户登录

**请求**:
\`\`\`json
{
  \"email\": \"string\",
  \"password\": \"string\"
}
\`\`\`

**响应**:
\`\`\`json
{
  \"token\": \"string\",
  \"user\": {...}
}
\`\`\`

**状态码**:
- 200: 成功
- 401: 认证失败

---

(继续其他端点...)" --yolo
```

---

## 场景5: 重构建议

### 触发语

```
Gemini帮我分析这个项目应该怎么重构
```

### 执行命令

```bash
cd /path/to/project && gemini --all-files -p "请分析这个项目并给出重构建议：

## 分析维度
1. **架构层面**: 整体架构的问题和改进方向
2. **模块层面**: 各模块的职责是否清晰
3. **代码层面**: 需要重写/优化的具体代码

## 输出格式

### 当前架构评估
- 优点: ...
- 问题: ...

### 重构建议

#### 高优先级重构
| 目标 | 当前问题 | 建议方案 | 工作量 |

#### 中优先级重构
...

#### 可选优化
...

### 重构路线图
1. 第一阶段: xxx (预计X天)
2. 第二阶段: xxx (预计X天)
...

### 风险提示
- ..." --yolo
```

---

## 场景6: 测试覆盖分析

### 触发语

```
用Gemini检查项目的测试覆盖情况
```

### 执行命令

```bash
cd /path/to/project && gemini --all-files -p "请分析项目的测试覆盖情况：

## 分析内容
1. **测试文件识别**: 找出所有测试文件
2. **覆盖情况**: 哪些模块有测试？哪些没有？
3. **测试质量**: 测试是否有效？是否测试了边界情况？
4. **建议补充**: 应该增加哪些测试？

## 输出格式

### 测试概览
- 测试框架: xxx
- 测试文件数: xxx
- 估计覆盖率: xxx%

### 覆盖情况
| 模块 | 有测试? | 测试类型 | 覆盖评估 |

### 缺失测试
1. **xxx模块** - 原因: 关键业务逻辑
2. ...

### 测试质量问题
- ...

### 建议新增测试
| 模块/函数 | 优先级 | 测试场景 |" --yolo
```

---

## 高级用法

### 聚焦特定目录

```bash
# 只分析src目录
cd /path/to/project/src && gemini --all-files -p "..." --yolo

# 分析指定文件
gemini -p "比较这两个实现" impl1.js impl2.js --yolo
```

### 排除特定文件

```bash
# 先创建临时目录，排除不需要的文件
rsync -av --exclude='node_modules' --exclude='.git' --exclude='dist' \
  /path/to/project/ /tmp/project-clean/
cd /tmp/project-clean && gemini --all-files -p "..." --yolo
```

### 分析特定语言

```bash
# 只看Python文件
find . -name "*.py" -exec cat {} \; | gemini -p "分析这些Python代码..." --yolo
```

---

## 注意事项

1. **仓库大小**: 超大仓库可能需要分批分析
2. **敏感文件**: 确保没有包含密钥、密码的文件
3. **二进制文件**: --all-files会跳过二进制文件
4. **生成目录**: 记得排除node_modules、dist等
5. **私有代码**: 代码会上传到Google服务器
